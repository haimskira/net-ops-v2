<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;700&display=swap" rel="stylesheet">
<style>
    body { font-family: 'Assistant', sans-serif; background-color: #0f172a; color: #f8fafc; padding: 20px; }
    /* תיקון השגיאה - CSS רגיל */
    .status-pill { 
        padding: 0.25rem 0.75rem; 
        border-radius: 9999px; 
        font-size: 0.75rem; 
        font-weight: 700; 
    }
</style>
</head>
<body>
    <h1 class="text-xl font-bold text-indigo-400 mb-6">מעקב בקשות חוקתיות</h1>
    <div id="requests-list" class="space-y-3"></div>

    <script>
        async function loadRequests() {
            try {
                const res = await fetch('/get-my-requests');
                const data = await res.json();
                const container = document.getElementById('requests-list');
                
                if (data.length === 0) {
                    container.innerHTML = '<p class="text-slate-500 text-center py-10">אין בקשות להצגה.</p>';
                    return;
                }

                container.innerHTML = data.reverse().map(r => {
                    let statusClass = "bg-orange-500/10 text-orange-500 border-orange-500/20";
                    let statusText = "ממתין לאישור";
                    let icon = "⏳";

                    if (r.status === 'Approved') {
                        statusClass = "bg-emerald-500/10 text-emerald-500 border-emerald-500/20";
                        statusText = "אושר ובוצע";
                        icon = "✅";
                    } else if (r.status === 'Rejected') {
                        statusClass = "bg-rose-500/10 text-rose-500 border-rose-500/20";
                        statusText = "נדחה על ידי אדמין";
                        icon = "❌";
                    }

                    return `
                        <div class="bg-slate-900/50 border border-slate-800 p-4 rounded-xl flex justify-between items-center transition-all hover:bg-slate-800/50 shadow-lg">
                            <div class="flex items-center gap-4">
                                <span class="text-xl">${icon}</span>
                                <div>
                                    <p class="font-bold text-slate-200">${r.rule_name}</p>
                                    <p class="text-xs text-slate-500">${r.source_ip} ➔ ${r.destination_ip} (${r.service_port}/${r.protocol})</p>
                                </div>
                            </div>
                            <div class="text-left text-right">
                                <span class="px-3 py-1 rounded-full text-[10px] font-bold border ${statusClass}">
                                    ${statusText}
                                </span>
                                <p class="text-[9px] text-slate-600 mt-2">${r.request_time || ''}</p>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (e) {
                console.error("Error loading requests:", e);
            }
        }
        
        loadRequests();
        setInterval(loadRequests, 10000);
    </script>
</body>
</html>